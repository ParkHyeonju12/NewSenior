<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="nsClass">
	<select id ="getAllClass" parameterType="map" resultType="cla">
		select * from
			(select rownum as rnum,c.* from
			(select  
				class_no as classNo,
				class_name as className,
				class_teacher as classTeacher,
				class_price as classPrice,
				class_limit as classLimit,
				class_status as classStatus,
				class_category as classCategory,
				products,
				start_date as startDate,
				end_date as endDate,
				filepath,
				m.member_name as teacherName
		from CLASSES c
		join members m 
		on c.class_teacher = m.member_no
		order by 1 desc)c)
		where rnum between #{start} and #{end}
	</select>
	
	
	<!--  모든 칼럼 셀렉트
	<select id="getAllMembers" resultType="m">
	select
	member_no as memberNo,
	member_id as memberId,	   
	member_pw as memberPW,
    member_name as memberName,
	member_phone as memberPhone,
	member_email as memberEmail,
	member_addr	as memberAddr,    
	member_grade as memberGrade,
	member_birth as memberBirth,
	enroll_date	as enrollDate,
	nickname as nickName,
	member_state as memberState,	
    member_img as memberImg
    from members
	</select>
	 -->
	 
	 
	<select id="totalCount" resultType="int">
		select count(*) from classes
	</select>

	<insert id="insertClass" parameterType="cla">
		insert into
		CLASSES
		values(
		class_seq.nextval,#{className},#{classTeacher},
		'0',#{classLimit},3,#{classCategory},#{products},
		#{startDate},#{endDate},#{filepath},#{teacherIntroduce},
		#{curriculum})
		<selectKey resultType="_int" order="AFTER" keyProperty="classNo">
			select max(class_no) from classes
		</selectKey>
	</insert>
	
	<insert id="insertFile" parameterType="claF">
		insert into 
		class_file
		values
		(
			CLASS_FILENO.nextval,
			#{classNo},#{filename},#{filepath}
		)
	</insert>
	
	<select id ="getAllCategory" resultType="string">
		select column_name 
		from user_tab_columns 
		where table_name = 'CATEGORY'
	</select>
	
	<!-- 은비 class 리스트 가져오기 -->
	<select id="selectClassList" parameterType="cla" resultType="cla">
		select  
			class_no as classNo,
			class_name as className,
			class_teacher as classTeacher,
			class_price as classPrice,
			class_limit as classLimit,
			class_status as classStatus,
			class_category as classCategory,
			products,
			start_date as startDate,
			end_date as endDate,
			filepath
		from classes
		<if test="classCategory != null">
		where class_category = #{classCategory }
		</if>
	</select>
</mapper>