<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="nsClass">
	<select id ="getAllClass" parameterType="map" resultType="cla">
		select * from
			(select rownum as rnum,c.* from
			(select  
				class_no as classNo,
				class_name as className,
				class_teacher as classTeacher,
				to_char(class_price,'999,999,999') as classPrice,
				class_limit as classLimit,
				class_status as classStatus,
				class_category as classCategory,
				products,
				to_char(start_date,'yyyy-mm-dd') as startDate,
				to_char(end_date,'yyyy-mm-dd')  as endDate,
				filepath,
				TO_DATE(end_date) - TO_DATE(start_date)+1 as dayDate,
				m.member_name as teacherName
		from CLASSES c
		join members m 
		on c.class_teacher = m.member_no
		where class_status in (0,1)
		order by 1 desc)c)	
		where rnum between #{start} and #{end}
		
	</select>
	
	
	<!--  모든 칼럼 셀렉트
	<select id="getAllMembers" resultType="m">
	select
	member_no as memberNo,
	member_id as memberId,	   
	member_pw as memberPW,
    member_name as memberName,
	member_phone as memberPhone,
	member_email as memberEmail,
	member_addr	as memberAddr,    
	member_grade as memberGrade,
	member_birth as memberBirth,
	enroll_date	as enrollDate,
	nickname as nickName,
	member_state as memberState,	
    member_img as memberImg
    from members
	</select>
	 -->
	 
	 
	<select id="totalCount" resultType="int">
		select count(*) from classes
		where class_status in (0,1)
	</select>

	<insert id="insertClass" parameterType="cla">
		insert into
		CLASSES
		values(
		class_seq.nextval,#{className},#{classTeacher},
		'0',#{classLimit},3,#{classCategory},#{products},
		#{startDate},#{endDate},#{filepath},#{teacherIntroduce},
		#{curriculum})
		<selectKey resultType="_int" order="AFTER" keyProperty="classNo">
			select max(class_no) from classes
		</selectKey>
	</insert>
	
	<insert id="insertFile" parameterType="claF">
		insert into 
		class_file
		values
		(
			CLASS_FILENO.nextval,
			#{classNo},#{filename},#{filepath}
		)
	</insert>
	
	<select id ="getAllCategory" resultType="string">
		select column_name 
		from user_tab_columns 
		where table_name = 'CATEGORY'
	</select>
	
	<!-- 은비 class 리스트 가져오기 -->
	<select id="selectClassList" parameterType="cla" resultType="cla">
		select  
			class_no as classNo,
			class_name as className,
			class_teacher as classTeacher,
			class_price as classPrice,
			class_limit as classLimit,
			class_status as classStatus,
			class_category as classCategory,
			products,
			start_date as startDate,
			end_date as endDate,
			filepath
		from classes
		<if test="classCategory != null">
		where class_category = #{classCategory }
		</if>
	</select>
	
	<select id="holdClass" resultType="cla">
		select  
			class_no as classNo,
			class_name as className,
			class_teacher as classTeacher,
			class_price as classPrice,
			to_char(start_date,'yyyy-mm-dd') as startDate,
			to_char(end_date,'yyyy-mm-dd') as endDate,
			TO_DATE(end_date) - TO_DATE(start_date)+1 as dayDate,
			m.member_name as teacherName
		from CLASSES c
		join members m 
		on c.class_teacher = m.member_no
		where class_status = 3
	</select>
	
	<select id="getOneClass" parameterType="_int" resultType="cla">
		select  
				class_no as classNo,
				class_name as className,
				class_teacher as classTeacher,
				class_price as classPrice,
				class_limit as classLimit,
				class_status as classStatus,
				class_category as classCategory,
				products,
				to_char(start_date,'yyyy-mm-dd') as startDate,
				to_char(end_date,'yyyy-mm-dd')  as endDate,
				filepath,
				teacher_introduce as teacherIntroduce,
		 		curriculum,
				m.member_name as teacherName
		from CLASSES c
		join members m 
		on c.class_teacher = m.member_no
		where class_no= #{classNo}
	</select>
	
	<select id="getMyClass" parameterType="_int" resultType="cla">
		select  
				class_no as classNo,
				class_name as className,
				class_teacher as classTeacher,
				filepath
		from CLASSES c
		join members m 
		on c.class_teacher = m.member_no
		where c.class_teacher = #{memberNo}
	</select>

	 
	<select id="getOneFiles" parameterType="_int" resultType="claF">
		select  
			class_fileno as fileNo,
			class_no as classNo,
			class_filename as filename,
			class_filepath as filepath
		from class_file
		where class_no = #{classNo}
	</select>
	 
	<update id="changeStatus" parameterType="cla">
		update classes
		set class_status = 0,
		 	class_price = #{classPrice}
		where class_no = #{classNo}
	</update>
</mapper>